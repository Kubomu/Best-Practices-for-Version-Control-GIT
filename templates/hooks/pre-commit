#!/bin/bash
# Pre-commit hook example
# Copy to .git/hooks/pre-commit and make executable: chmod +x .git/hooks/pre-commit

echo "Running pre-commit checks..."

# Check for debugging statements
if git diff --cached --name-only | grep -E '\.(js|ts|py|go|java)$' | xargs grep -n -E '(console\.log|print\(|fmt\.Println|System\.out\.println|debugger)' 2>/dev/null; then
    echo "❌ Error: Found debugging statements (console.log, print, etc.)"
    echo "Please remove them before committing."
    exit 1
fi

# Check for TODO/FIXME without issue reference
if git diff --cached | grep -E '^\+.*\b(TODO|FIXME)\b' | grep -v '#[0-9]'; then
    echo "⚠️  Warning: Found TODO/FIXME without issue reference"
    echo "Consider adding issue numbers: TODO(#123): description"
fi

# Check for large files
large_files=$(git diff --cached --name-only | xargs ls -l 2>/dev/null | awk '$5 > 1048576 {print $9}')
if [ -n "$large_files" ]; then
    echo "❌ Error: Found files larger than 1MB:"
    echo "$large_files"
    echo "Consider using Git LFS for large files."
    exit 1
fi

# Check for merge conflict markers
if git diff --cached | grep -E '^(\+|-)<<<<<<< |^(\+|-)>>>>>>> |^(\+|-)=======$'; then
    echo "❌ Error: Found merge conflict markers"
    exit 1
fi

# Check for trailing whitespace
if git diff --cached --check; then
    :
else
    echo "❌ Error: Found trailing whitespace"
    exit 1
fi

echo "✅ Pre-commit checks passed!"
exit 0
